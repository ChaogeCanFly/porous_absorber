<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
<link rel="stylesheet" href="styles/normalize.css">
<link rel="stylesheet" href="styles/style.css">

<title>Porous Absorber Calculator</title>

<script src="./js/utils.js"></script>
<script>
// Debug/trace utilities
const DEBUG = false

const do_trace = isDebug => traceStr => isDebug ? console.log(traceStr) : no_op
const    trace = do_trace(DEBUG)
</script>
<script src="./js/local_storage.js"></script>
<script src="./js/dom_access.js"></script>
<script src="./js/unit_conversion.js"></script>
<script src="./js/tab_manager.js"></script>
<script src="./js/config.js"></script>
<script>
// *********************************************************************************************************************
// Globally declare names of local storage access functions
// Function store_tab_values will be called from the onblur event on the tab bar button
var restore_tab_values = null
var   store_tab_values = null
var         get_config = null

// *********************************************************************************************************************
// Activate configuration tab and select default tab
async function start() {
  trace("---> start()")
  let can_i_haz_local_storage = storageAvailable("localStorage")

  // Define which function is called based on the availability of local storage
  restore_tab_values = can_i_haz_local_storage ? restore_from_local_storage : no_op
    store_tab_values = can_i_haz_local_storage ?     write_to_local_storage : no_op

  get_config = can_i_haz_local_storage ? fetch_config_values : fetch_config_from_dom

  // Ensure the configuration tab is always loaded
  await fetch_tab("configuration")

  // Select the default tab
  for (var tablink of $class("tabButton")) {
    if (tablink.getAttribute("default") === "true") tablink.click()
  }

  trace("<--- start()")
}

</script>
<script type="module">
trace("---> WASM module")

// Get reference to the JavaScript wrapper function generated by wasm-pack
import init
, { rb_porous_absorber
  , perforated_panel
}
from './pkg/porous_absorber_calculator.js'

// Make the JavaScript wrapper functions accessible to coding outside this module
window.rb_porous_absorber    = rb_porous_absorber
window.slotted_panel         = no_op
window.perforated_panel      = perforated_panel
window.microperforated_panel = no_op
window.configuration         = no_op

async function wasm_start() {
  await init()
  console.log("WASM module initialisation complete...")
  start()
}

wasm_start()

trace("<--- WASM module")
</script>
</head>

<body>
  <!-- Tab bar -->
  <div class="tab">
    <button onclick="openTab(event, 'rb_porous_absorber')"    id="tab_button_rb_porous_absorber"    class="tabButton">Rigid Backed Porous Absorber</button>
    <button onclick="openTab(event, 'slotted_panel')"         id="tab_button_slotted_panel"         class="tabButton">Slotted Panel</button>
    <button onclick="openTab(event, 'perforated_panel')"      id="tab_button_perforated_panel"      class="tabButton" default="true">Perforated Panel</button>
    <button onclick="openTab(event, 'microperforated_panel')" id="tab_button_microperforated_panel" class="tabButton">Microperforated Panel</button>
    <button onclick="openTab(event, 'configuration')"         id="tab_button_configuration"         class="tabButton">Configuration</button>
  </div>

  <!-- Tab content -->
  <div id="rb_porous_absorber"    class="tabContent"></div>
  <div id="perforated_panel"      class="tabContent"></div>
  <div id="slotted_panel"         class="tabContent"></div>
  <div id="microperforated_panel" class="tabContent"></div>
  <div id="configuration"         class="tabContent"></div>
</body>
</html>